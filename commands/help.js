const { SlashCommandBuilder, EmbedBuilder } = require('discord.js');

module.exports = {
    data: new SlashCommandBuilder()
        .setName('help')
        .setDescription('Lists all available commands or provides info about a specific command.')
        .addStringOption(option =>
            option.setName('command')
                .setDescription('The command to get info about')
                .setRequired(false)),
    async execute(interaction) {
        const { client } = interaction;
        const commandName = interaction.options.getString('command');

        if (commandName) {
            // Handle specific command help
            const command = client.commands.get(commandName.toLowerCase());

            if (!command) {
                return interaction.reply({
                    content: `æˆ‘æ‰¾ä¸åˆ°åä¸º \`${commandName}\` çš„å‘½ä»¤ã€‚(I couldn't find a command named \`${commandName}\`.)`,
                    ephemeral: true
                });
            }

            const embed = new EmbedBuilder()
                .setColor('#0099ff')
                .setTitle(`/${command.data.name} Command Info`)
                .setDescription(command.data.description || 'æ²¡æœ‰æä¾›æè¿°ã€‚(No description provided.)');

            // You can add more details here if your commands have more properties like options, usage, etc.
            if (command.data.options && command.data.options.length > 0) {
                const options = command.data.options.map(opt => {
                    let optString = `\`${opt.name}\`: ${opt.description}`;
                    if (opt.required) optString += ' (Required)';
                    return optString;
                }).join('\n');
                embed.addFields({ name: 'Options (é€‰é¡¹)', value: options });
            }

            return interaction.reply({ embeds: [embed], ephemeral: true });

        } else {
            // List all commands
            const commands = client.commands.map(command => `\`/${command.data.name}\` - ${command.data.description || 'æ²¡æœ‰æè¿°ã€‚(No description.)'}`);

            const embed = new EmbedBuilder()
                .setColor('#0099ff')
                .setTitle('ğŸ¤– Available Commands (å¯ç”¨å‘½ä»¤)')
                .setDescription(
                    `ä»¥ä¸‹æ˜¯æˆ‘æ‰€æœ‰çš„å‘½ä»¤ï¼š\n(Here are all my commands:)\n\n${commands.join('\n')}\n\n` +
                    `ä½ å¯ä»¥ä½¿ç”¨ \`/help [å‘½ä»¤åç§°]\` æ¥è·å–ç‰¹å®šå‘½ä»¤çš„æ›´å¤šä¿¡æ¯ã€‚\n(You can use \`/help [command name]\` for more info on a specific command.)`
                )
                .setFooter({ text: 'ç”± Gemini CLI ç”Ÿæˆ (Generated by Gemini CLI)' })
                .setTimestamp();

            return interaction.reply({ embeds: [embed], ephemeral: true });
        }
    },
};